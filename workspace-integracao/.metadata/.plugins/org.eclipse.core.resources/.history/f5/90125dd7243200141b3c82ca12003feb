package com.fiap.contamedica.gateway;

import java.util.Properties;

import javax.jms.Queue;
import javax.jms.QueueConnection;
import javax.jms.QueueConnectionFactory;
import javax.naming.Context;
import javax.naming.InitialContext;

/**
 * Classe abstrata responsável em prover a comunicação com a queue,
 * ou seja, criar e fechar a conexão.
 * 
 * @author Luiz Fernando 
 *
 */
public abstract class QueueBase {

	public QueueBase() {}
	
	QueueConnection queueConnection;
	Context jndiContext;
	QueueConnectionFactory queueConnectionFactory;
	
	protected  QueueConnection obterConexaoQueue(String nomeFila) {
		
		jndiContext = getInitial();
		
		queueConnectionFactory = (QueueConnectionFactory) jndiContext.lookup("ConnectionFactory");
		queue = (Queue) jndiContext.lookup(NOME_FILA);
		queueConnectionFactory.createQueueConnection();
		
	}
	
	private static InitialContext getInitial() throws Exception {
		Properties props = new Properties();
		props.setProperty("java.naming.factory.initial", "org.jnp.interfaces.NamingContextFactory");
		props.setProperty("java.naming.provider.url", "localhost:1099");
		props.setProperty("java.naming.factory.url.pkgs", "org.jboss.naming");
		InitialContext context = new InitialContext(props);
		return context;
	}

}
